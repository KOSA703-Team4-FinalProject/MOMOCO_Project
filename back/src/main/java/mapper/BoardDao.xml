<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.dao.BoardDao">

	<!-- 알람에서 사용, 해당 알람이 발생할 게시글 찾기 public Board getBoardByTitle(Board board) -->
	<select id="getBoardByTitle" parameterType="kr.or.vo.Board" resultType="kr.or.vo.Board"> 
		select idx, title, content, to_char(w_date, 'YYYY-MM-DD') as w_date, nickname, b.b_code, t.b_name, label, u_idx
		from board_${url} b join board_type_${url} t
		on b.b_code = t.b_code
		where title = #{title} and u_idx = #{u_idx} and content = #{content} and label = #{label}
	</select>


	<!--전체 보드 리스트 -->
	<select id="allBoardList" parameterType="kr.or.vo.Board" resultType="kr.or.vo.Board">
	SELECT a.idx, a.title,a.content, h.profilephoto ,j.u_idx as u_idx1, a.b_code ,a.nickname,a.w_date
	FROM board_${url} a
	left outer JOIN doc_storage_${url} b ON a.idx = b.idx
	 left outer JOIN common_board_${url} c ON a.idx = c.idx
	left outer JOIN board_status_${url} d ON a.idx = d.idx
	left outer JOIN calendar_${url} e ON e.idx = a.idx
	left outer JOIN kanban_${url} f ON f.idx = d.idx
    left outer join label_${url} g on a.label = g.label
    left outer JOIN member h on a.u_idx =h.u_idx 
    left outer join board_type_${url} i on a.b_code =i.b_code
    LEFT JOIN checked_${url} j ON j.idx = a.idx
 	 order by a.idx desc
	</select>
	
	<!-- b_code 검색 -->
	<select id="searchboardnumber" parameterType="kr.or.vo.Board" resultType="kr.or.vo.Board">

	
	SELECT  a.idx, a.title, a.content, h.profilephoto ,a.b_code ,a.nickname,a.w_date, j.u_idx as idx1
	FROM 
    board_momoco a
    LEFT OUTER JOIN doc_storage_momoco b ON a.idx = b.idx
    LEFT OUTER JOIN common_board_momoco c ON a.idx = c.idx
    LEFT OUTER JOIN board_status_momoco d ON a.idx = d.idx
    LEFT OUTER JOIN calendar_momoco e ON e.idx = a.idx
    LEFT OUTER JOIN kanban_momoco f ON f.idx = d.idx
    LEFT OUTER JOIN label_momoco g ON a.label = g.label
    LEFT OUTER JOIN member h ON a.u_idx = h.u_idx 
    LEFT OUTER JOIN board_type_momoco i ON a.b_code = i.b_code
    LEFT JOIN checked_momoco j ON j.idx = a.idx
    <if test="type != null and type =='boardnumber1'">
 		WHERE a.b_code LIKE #{keyword}
	</if>
	GROUP BY a.idx,a.title,a.content,h.profilephoto,a.b_code,a.nickname,a.w_date,j.u_idx
	ORDER BY  a.idx DESC
	</select>
	
	<!-- 검색어로 검색 -->
	<select id="boardSearch" parameterType="kr.or.vo.Board" resultType="kr.or.vo.Board">
    SELECT *
	FROM board_${url} a
	left outer JOIN doc_storage_${url} b ON a.idx = b.idx
	left outer JOIN common_board_${url} c ON a.idx = c.idx
	left outer JOIN board_status_${url} d ON a.idx = d.idx
	left outer JOIN calendar_${url} e ON e.idx = a.idx
	left outer JOIN kanban_${url} f ON f.idx = d.idx
    <if test="type != null and type == 'title_content'">
        WHERE a.title LIKE '%' || #{keyword} || '%' OR a.content LIKE '%' || #{keyword} || '%'
    </if>
    ORDER BY a.idx DESC
	</select>
	
	
</mapper>