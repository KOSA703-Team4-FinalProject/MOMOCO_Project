<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.dao.CommonBoardDao">

	<!-- commandBoard list-->
	
	<!-- 전체 글 확인 public List<Board> getBoard() -->
	<select id="getBoard"  parameterType="int" resultType="kr.or.vo.CommonBoard">
		select a.idx, a.nickname, a.title, a.content, a.w_date, a.b_code, a.label, a.u_idx, b.b_idx, b.ori_filename, 
		b.save_filename, b.volume, b.filetype, b.ref,b.depth,b.step,b.thumb,b.idx from board_${url} a join common_board_${url} b on a.idx = b.idx
		where b_code = 5 
		order by b.b_idx desc
		
	</select>
	
   <!-- 글읽기-->
  	<select id="getBoardByIdx" parameterType="kr.or.vo.CommonBoard" resultType="kr.or.vo.CommonBoard">
		 select b.idx , b.nickname, b.title, b.content, to_char(b.w_date ,'YYYY-MM-DD')as w_date, b.b_code, b.label, b.u_idx, c.ori_filename, c.save_filename, c.filetype, c.ref, c.depth,c.step, c.thumb, m.profilephoto
		from board_${url} b join common_board_${url} c
 		on b.idx = c.idx 
		join member m
 		on m.u_idx = b.u_idx
		where c.idx = #{idx}
	</select>
	
	<!-- 글쓰기 -->
	<insert id="addCommonBoard" parameterType="kr.or.vo.CommonBoard">
	INSERT ALL
	INTO board_${url} (idx, nickname, title, content, b_code, label, u_idx)
		VALUES (BOARD_IDX_SEQ_${url}.nextval, '${nickname}', '${title}', '${content}', ${b_code}, '${label}', ${u_idx})
	INTO common_board_${url}(b_idx, ori_filename, save_filename, volume, filetype, ref, depth, step, thumb, idx)
		VALUES (COMMON_BOARD_B_IDX_SEQ_${url}.nextval, '${ori_filename}', '${save_filename}', ${volume}, '${filetype}', ${ref}, ${depth}, ${step}, '${thumb}', board_idx_seq_${url}.CURRVAL)
		
	SELECT * FROM dual
	</insert>
	<!-- 글수정하기 -->
	<update id="updateCommonBoard" parameterType="kr.or.vo.CommonBoard">
		 UPDATE board_${url}
        SET nickname = #{nickname}, title = #{title}, content = #{content}
        WHERE idx = #{idx};
        
        UPDATE common_${url}
        SET b_idx = #{b_idx}, ori_filename = #{ori_filename}, save_filename = #{save_filename}, volume = #{volume}, filetype = #{filetype}, thumb = #{thumb}
        WHERE idx = #{idx};
	
	</update>
	
	<!--삭제  -->
	<delete id="deletecommonboard" parameterType="kr.or.vo.CommonBoard">
		delete from board_${url} where idx = #{idx}
	</delete>
	<!-- 검색-->
	
	<!--알림보낼사람 선택하기-->
	<select id="boardalramlist" parameterType="kr.or.vo.CommonBoard" resultType="kr.or.vo.CommonBoard">
		select a.url , a.u_idx,b.nickname , b.profilephoto
		from WORKSPACE_USER a join member b on a.u_idx = b.u_idx 
		where a.url = '${url}'
	</select>
	
	
</mapper>